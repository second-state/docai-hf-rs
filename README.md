<!-- <div align="center">
  <h1><code>DocAI-HuggingFaces-Rs</code></h1>
  <p>
    < add CI badge here once workflow details are created >
    <a href="https://crates.io/crates/"> <add crate name here>
      <img src="https://img.shields.io/crates/v/" alt="crates.io status" height="20"/> <add crate svg here>
    </a>
    <a href="https://docs.rs/"> <add link to autogenerated docs here>
      <img src="https://img.shields.io/docsrs/" alt="doc.rs status" height="20"/> <add image of docs here>
    </a>
  </p>
</div> -->

# A Rust library for Document-AI tasks for WasmEdge WASI-NN

## Introduction

A Rust implementation that focuses on the document AI tasks provided by Microsoft's models available on the Hugging Face website.

## Task APIs

Every task has three types: ```XxxBuilder```, ```Xxx```, ```XxxSession```. (``Xxx`` is the task name)

* ```XxxBuilder``` is used to create a task instance ```Xxx```, which has many options to set.

  example: use ```DocumentClassifierBuilder``` to build a ```DocumentClassifier``` task.
  ```
  let classifier = DocumentClassifierBuilder::new()
        .model_asset_path(model_path) // set model path
        .gpu() // set running device
        .finalize()?; // create a image classifier
  ```
* ```Xxx``` is a task instance, which contains task information and model information.

  example: use ```DocumentClassifier``` to create a new ```DocumentClassifierSession```
  ```
  let classifier_session = classifier.new_session()?;
  ```
* ```XxxSession``` is a running session to perform pre-process, inference, and post-process, which has buffers to store
  mid-results.

  example: use ```DocumentClassifierSession``` to run the image classification task and return classification results:
  ```
  let classification_result = classifier_session.classify(&image::open(img_path)?)?;
  ```
  **Note**: the session can be reused to speed up, if the code just uses the session once, it can use the task's wrapper
  function to simplify.
  ```
  // let classifier_session = classifier.new_session()?;
  // let classification_result = classifier_session.classify(&image::open(img_path)?)?;
  // The above 2-line code is equal to: 
  let classification_result = classifier.classify(&image::open(img_path)?)?;
  ```

### Available tasks

* Document Classification: `DocumentClassifierBuilder` -> `DocumentClassifier` -> `DocumentClassifierSession`

## Examples

### Document classification

```rust
fn parse_args() -> Result<(String, String), Box<dyn std::error::Error>> {
    let args: Vec<String> = std::env::args().collect();
    if args.len() != 3 {
        return Err(format!("Usage {} model_path image_path", args[0]).into());
    }
    Ok((args[1].clone(), args[2].clone()))
}

use docai_hf_rs::tasks::DocumentClassifierBuilder;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    let (model_path, img_path) = parse_args()?;
    println!("model-path {:?} ", model_path);

    let classification_result = DocumentClassifierBuilder::new()
        // .max_results(3) // set max result
        .build_from_file(model_path)? // create a image classifier using model pat
        .classify(&img_path)?; // do inference and generate results

    // show formatted result message
    println!("The top classification result is : \n");
    println!("{}", classification_result[0]);

    Ok(())
}

```

Example input:

<img height="30%" src="./assets/testdata/document.png" width="30%"/>


Example output in console:

```console
$ cargo run --release --example document_classification -- assets/models/dit-base-finetuned-rvlcdip-jit-torch-1.8.2-cpu.pt assets/testdata/document.png

   Compiling docai_hf_rs v0.1.0 (/home/sarrah/1_data/wasmedge_intern/pytorch-wasm-lib)
    Finished release [optimized] target(s) in 0.21s
     Running `/home/sarrah/1_data/wasmedge_intern/pytorch-wasm-lib/./scripts/wasmedge-runner.sh target/wasm32-wasi/release/examples/document_classification.wasm assets/models/dit-base-finetuned-rvlcdip-jit-torch-1.8.2-cpu.pt assets/testdata/document.png`
     
The top classification result is : 

Category name: "form"
Score:         4.50600290
Index:         1

```    
##  Notice

This work is made possible by **Microsoft's work on [Hugging Faces](https://huggingface.co/)** and **[yanghaku](https://github.com/yanghaku)'s work on [WasmEdge/mediapipe-rs](https://github.com/WasmEdge/mediapipe-rs)**.
